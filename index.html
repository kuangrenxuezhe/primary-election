<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Primary-election by kuangrenxuezhe</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Primary-election</h1>
      <h2 class="project-tagline"></h2>
      <a href="https://github.com/kuangrenxuezhe/primary-election" class="btn">View on GitHub</a>
      <a href="https://github.com/kuangrenxuezhe/primary-election/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/kuangrenxuezhe/primary-election/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="初选集" class="anchor" href="#%E5%88%9D%E9%80%89%E9%9B%86" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>初选集</h1>

<h2>
<a id="设计要求" class="anchor" href="#%E8%AE%BE%E8%AE%A1%E8%A6%81%E6%B1%82" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>设计要求</h2>

<ul>
<li>支持在线用户300万</li>
<li>保留7天的历史新闻数据, 淘汰粒度按照分钟算</li>
<li>按照注册用户18天，非注册用户3天进行淘汰, 淘汰粒度按照天算<br>
<em>注：区分注册用户和非注册用户方法，根据用户ID小于1000,000,000为注册用户</em>
</li>
</ul>

<h2>
<a id="功能说明" class="anchor" href="#%E5%8A%9F%E8%83%BD%E8%AF%B4%E6%98%8E" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>功能说明</h2>

<ul>
<li>记录用户订阅信息（每次为全局更新）</li>
<li>记录用户操作记录（包括: 点击，不喜欢； 点赞，评论，收藏和分享暂时没处理）</li>
<li>记录新闻数据信息</li>
<li>记录用户对信息的操作记录</li>
<li>查询用户是否存在（被淘汰后的用户当做新用户）</li>
<li>查询用户的浏览历史记录</li>
<li>获取推荐初选列表</li>
</ul>

<h2>
<a id="存储数据" class="anchor" href="#%E5%AD%98%E5%82%A8%E6%95%B0%E6%8D%AE" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>存储数据</h2>

<ul>
<li>用户数据

<ul>
<li>用户最后阅读时间</li>
<li>阅读过的新闻</li>
<li>推荐过的新闻</li>
<li>不喜欢的新闻</li>
<li>用户订阅的圈子和SRP词</li>
</ul>
</li>
<li>新闻数据

<ul>
<li>用户的点击计数(注：经常变动)</li>
<li>发布时间</li>
<li>入库时间</li>
<li>包含图片个数</li>
<li>所属分类（可多个）</li>
<li>新闻关键词</li>
<li>SRP词（可多个）</li>
<li>所属圈子（可多个）</li>
<li>全局推荐/部分推荐</li>
<li>部分推荐所属SRP词</li>
<li>部分推荐所属圈子</li>
<li>所属地域</li>
<li>数据类型（新闻，视频）</li>
</ul>
</li>
</ul>

<h2>
<a id="数据持久化" class="anchor" href="#%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>数据持久化</h2>

<p>数据按照分层存储即：L0,L1...LN, L0为顶层, 其数据为活跃状态，可对其进行修改（增，删，改）。
L1...LN为非顶层,其数据为非活跃状态，不可对其进行修改。
1. 若对处于非活跃状态数据进行修改, 采取copy-on-write方式，将其复制到顶层后再进行修改。
2. 层级之间合并只能按照从N到1合并顺序，且在合并内存中的数据时需先合并磁盘中的数据。
3. 数据结构按照元数据加数据体方式存储，元数据包含：频繁变更数据和数据体指针（注：在copy-on-write
时可以分层进行）
4. 数据淘汰通过向L0中添加删除标记，在后续层级合并时才物理删除。</p>

<h2>
<a id="不喜欢格式补充说明" class="anchor" href="#%E4%B8%8D%E5%96%9C%E6%AC%A2%E6%A0%BC%E5%BC%8F%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>不喜欢格式补充说明</h2>

<ol>
<li>内容为字符串，采用GBK编码</li>
<li>具体格式为：key1,key2:value;key:value， 如：
2.1 "1":"重复内容";"5_7":"分类:汽车新闻"
2.2 "7_2342323245345415124,8_15219559038051803483":"足球"</li>
<li>其中key表示不喜欢类型，value表示不喜欢原因， key和value均带有引号的，若其内容中包好
引号则需要使用转义字符"</li>
<li>不喜欢类型包括：1 重复内容，2 内容质量差，3 来源，4 广告，5 分类， 6 圈子，7 SRP, 8 TAG
其中，来源，分类，圈子和SRP类型格式为：type_ID，type表示类型，ID表示来源，分类，圈子或SPR的ID</li>
<li>当类型为1,2,4时不喜欢原因内容分别为：重复内容，内容质量差，广告，当类型为3,5,6,7时不喜欢原因分别
    为：来源名称，分类信息，圈子名称和SPR词
注： TAGid与系统的id分配是不一致的</li>
</ol>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/kuangrenxuezhe/primary-election">Primary-election</a> is maintained by <a href="https://github.com/kuangrenxuezhe">kuangrenxuezhe</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
